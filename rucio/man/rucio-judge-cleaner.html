

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Daemon rucio-judge-cleaner &mdash; Rucio 1.2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Daemon rucio-judge-evaluator" href="rucio-judge-evaluator.html" />
    <link rel="prev" title="Daemon rucio-hermes" href="rucio-hermes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Rucio
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts and terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replica_workflow.html">Typical replica workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasepolicy.html">Release policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes.html">Release notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing.html">Setting up a Rucio development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest.html">RESTful APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">The Client API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database.html">Database operations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing_clients.html">Installing Rucio Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_examples.html">Rucio CLI: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="rucio.html">Rucio CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="rucio-admin.html">Rucio Administrative CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rse_expressions.html">RSE Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clients.html">Rucio Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clients.html#errors-and-exceptions">Errors and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage.html">Advanced Usage</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing_server.html">Installing Rucio server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing_daemons.html">Installing Rucio daemons</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="daemons.html">Daemons CLIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="rucio-abacus-account.html">Daemon rucio-abacus-account</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-abacus-rse.html">Daemon rucio-abacus-rse</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-atropos.html">Daemon rucio-atropos</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-automatix.html">Daemon rucio-automatix</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-bb8.html">Daemon rucio-bb8</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-c3po.html">Daemon rucio-c3po</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-cache-consumer.html">Daemon rucio-cache-consumer</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-conveyor-finisher.html">Daemon rucio-conveyor-finisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-conveyor-poller.html">Daemon rucio-conveyor-poller</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-conveyor-receiver.html">Daemon rucio-conveyor-receiver</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-conveyor-stager.html">Daemon rucio-conveyor-stager</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-conveyor-submitter.html">Daemon rucio-conveyor-submitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-conveyor-throttler.html">Daemon rucio-conveyor-throttler</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-dark-reaper.html">Daemon rucio-dark-reaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-hermes.html">Daemon rucio-hermes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Daemon rucio-judge-cleaner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Named Arguments">Named Arguments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rucio-judge-evaluator.html">Daemon rucio-judge-evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-judge-injector.html">Daemon rucio-judge-injector</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-judge-repairer.html">Daemon rucio-judge-repairer</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-kronos.html">Daemon rucio-kronos</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-light-reaper.html">Daemon rucio-light-reaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-minos.html">Daemon rucio-minos</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-minos-temporary-expiration.html">Daemon rucio-minos-temporary-expiration</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-necromancer.html">Daemon rucio-necromancer</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-reaper.html">Daemon rucio-reaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-transmogrifier.html">Daemon rucio-transmogrifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="rucio-undertaker.html">Daemon rucio-undertaker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy_packages.html">Policy packages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demo_environment.html">Setting up a Rucio development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_examples.html">Rucio CLI: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_admin_examples.html">Rucio administration CLI: Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Individual contributors to the source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html#organisations-employing-contributors">Organisations employing contributors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Rucio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="daemons.html">Daemons CLIs</a> &raquo;</li>
        
      <li>Daemon rucio-judge-cleaner</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/man/rucio-judge-cleaner.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="daemon-rucio-judge-cleaner">
<h1>Daemon rucio-judge-cleaner<a class="headerlink" href="#daemon-rucio-judge-cleaner" title="Permalink to this headline">¶</a></h1>
<p><p>The Judge-Cleaner daemon is responsible for cleaning expired replication rules. It deletes rules by checking if the ‘expired_at’ date property is older than the current timestamp. If the rule is expired, it will first remove one lock for the replica and parent datasets if the DID belongs to any. Then it will set a tombstone to the replica to mark it as deletable if there are no rules protecting the replica. After these steps, the rule gets deleted.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">rucio</span><span class="o">-</span><span class="n">judge</span><span class="o">-</span><span class="n">cleaner</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">once</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">threads</span> <span class="n">THREADS</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="Named Arguments">
<h2>Named Arguments<a class="headerlink" href="#Named Arguments" title="Permalink to this headline">¶</a></h2>
<dl class="option-list">
<dt><kbd>--run-once</kbd></dt>
<dd><p>One iteration only</p>
<p>Default: False</p>
</dd>
<dt><kbd>--threads</kbd></dt>
<dd><p>Concurrency control: total number of threads on this process</p>
<p>Default: 1</p>
</dd>
</dl>
</div>
<p><p>Upload a file to your RSE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio upload --rse MOCK --scope mock --name file filename.txt
</pre></div>
</div>
<p>Set a replication rule for the file with a lifetime of one second:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio add-rule mock:file 1 MOCK2 --lifetime 1
</pre></div>
</div>
<p>Check the replication rules and the replicas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio list-rules mock:file
ID                                ACCOUNT    SCOPE:NAME    STATE[OK/REPL/STUCK]    RSE_EXPRESSION      COPIES  EXPIRES (UTC)        CREATED (UTC)
--------------------------------  ---------  ------------  ----------------------  ----------------  --------  -------------------  -------------------
c273c7ed75724143ad21c667e659456b  root       mock:file     REPLICATING[0/1/0]      MOCK2                    1  2018-12-03 09:53:09  2018-12-03 09:53:08
06f012771b0546dca0c908441c048964  root       mock:file     OK[1/0/0]               MOCK                     1                       2018-12-03 09:52:19

$ python
from rucio.db.sqla import session, models
from rucio.core.rse import get_rse_id
rse_id = get_rse_id(&#39;MOCK2&#39;)
session.get_session().query(models.RSEFileAssociation).filter_by(name=&#39;file&#39;, scope=&#39;mock&#39;, rse_id=rse_id).first().tombstone // None
session.get_session().query(models.RSEFileAssociation).filter_by(name=&#39;file&#39;, scope=&#39;mock&#39;, rse_id=rse_id).first().lock_cnt // 1
</pre></div>
</div>
<p>The first rule was created with an expiration date of one second after the creation date.</p>
<p>Run the daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio-judge-cleaner --run-once
</pre></div>
</div>
<p>Check the replication rules and the replicas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio list-rules mock:file
ID                                ACCOUNT    SCOPE:NAME    STATE[OK/REPL/STUCK]    RSE_EXPRESSION      COPIES  EXPIRES (UTC)    CREATED (UTC)
--------------------------------  ---------  ------------  ----------------------  ----------------  --------  ---------------  -------------------
06f012771b0546dca0c908441c048964  root       mock:file     OK[1/0/0]               MOCK                     1                   2018-12-03 09:52:19

$ python
from rucio.db.sqla import session, models
from rucio.core.rse import get_rse_id
rse_id = get_rse_id(&#39;MOCK2&#39;)
session.get_session().query(models.RSEFileAssociation).filter_by(name=&#39;file&#39;, scope=&#39;mock&#39;, rse_id=rse_id).first().tombstone // datetime.datetime(1970, 1, 1, 0, 0)
session.get_session().query(models.RSEFileAssociation).filter_by(name=&#39;file&#39;, scope=&#39;mock&#39;, rse_id=rse_id).first().lock_cnt // 0
</pre></div>
</div>
<p>The rule we created before was deleted and the replica of the file on RSE MOCK2 got a tombstone because there is no protecting rule anymore.</p>
</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rucio-judge-evaluator.html" class="btn btn-neutral float-right" title="Daemon rucio-judge-evaluator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rucio-hermes.html" class="btn btn-neutral float-left" title="Daemon rucio-hermes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2012-2018 CERN for the benefit of the ATLAS collaboration

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>