
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daemon rucio-necromancer &#8212; Rucio 1.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Daemon rucio-reaper" href="rucio-reaper.html" />
    <link rel="prev" title="Daemon rucio-minos-temporary-expiration" href="rucio-minos-temporary-expiration.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="daemon-rucio-necromancer">
<h1>Daemon rucio-necromancer<a class="headerlink" href="#daemon-rucio-necromancer" title="Permalink to this headline">¶</a></h1>
<p><p>The Necromancer daemon is responsible for managing bad replicas. If a replica that got declared bad has other replicas, it will try to recover it by requesting a new transfer. If there are no replicas anymore, then the file gets marked as lost.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">rucio</span><span class="o">-</span><span class="n">necromancer</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">once</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">threads</span> <span class="n">THREADS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">bulk</span> <span class="n">BULK</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="Named Arguments">
<h2>Named Arguments<a class="headerlink" href="#Named Arguments" title="Permalink to this headline">¶</a></h2>
<dl class="option-list">
<dt><kbd>--run-once</kbd></dt>
<dd><p>Runs one loop iteration</p>
<p>Default: False</p>
</dd>
<dt><kbd>--threads</kbd></dt>
<dd><p>Concurrency control: number of threads</p>
<p>Default: 1</p>
</dd>
<dt><kbd>--bulk</kbd></dt>
<dd><p>Bulk control: number of requests per cycle</p>
<p>Default: 1000</p>
</dd>
</dl>
</div>
<p><p>Lost replica:
In this example the file gets uploaded and will have only this replica as there are no replication rules. If it gets declared bad, there will be no replica to recover from.
Therefor the replica gets marked as lost.</p>
<p>Upload a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio upload --scope mock --rse MOCK --name file filename.txt
</pre></div>
</div>
<p>Check replicas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio list-file-replicas mock:file
+---------+--------+------------+-----------+---------------------------------------------------------+
| SCOPE   | NAME   | FILESIZE   |   ADLER32 | RSE: REPLICA                                            |
|---------+--------+------------+-----------+---------------------------------------------------------|
| mock    | file   | 149.000 B  |    948240 | MOCK: file://localhost:0/tmp/rucio_rse/mock/fb/d1/file  |
+---------+--------+------------+-----------+---------------------------------------------------------+
</pre></div>
</div>
<p>Declare it as bad:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio-admin replicas declare-bad file://localhost:0/tmp/rucio_rse/mock/fb/d1/file --reason &#39;bad&#39;
</pre></div>
</div>
<p>Run the daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio-necromancer --run-once
</pre></div>
</div>
<p>Check replicas again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio list-file-replicas mock:file
+---------+--------+------------+-----------+----------------+
| SCOPE   | NAME   | FILESIZE   | ADLER32   | RSE: REPLICA   |
|---------+--------+------------+-----------+----------------|
+---------+--------+------------+-----------+----------------+
</pre></div>
</div>
<p>Bad replica:
In this example the file gets uploaded and will have two replica. If it gets declared bad, then the daemon will try to recover it from the second replica.</p>
<p>Upload a file and replicate it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio upload --scope mock --rse MOCK filename.txt
$ rucio add-rule mock:file 1 MOCK2
$ rucio-conveyor-submitter --run-once
</pre></div>
</div>
<p>Check replicas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio list-file-replicas mock:file
+---------+--------+------------+-----------+---------------------------------------------------------+
| SCOPE   | NAME   | FILESIZE   |   ADLER32 | RSE: REPLICA                                            |
|---------+--------+------------+-----------+---------------------------------------------------------|
| mock    | file   | 149.000 B  |    948240 | MOCK: file://localhost:0/tmp/rucio_rse/mock/fb/d1/file  |
|---------+--------+------------+-----------+---------------------------------------------------------|
| mock    | file   | 149.000 B  |    948240 | MOCK2: file://localhost:1/tmp/rucio_rse/mock/fb/d1/file |
+---------+--------+------------+-----------+---------------------------------------------------------+
</pre></div>
</div>
<p>Declare one replica as bad:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio-admin replicas declare-bad file://localhost:1/tmp/rucio_rse/mock/fb/d1/file --reason &#39;bad&#39;
</pre></div>
</div>
<p>Run the daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio-necromancer --run-once
</pre></div>
</div>
<p>Check replicas again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rucio list-file-replicas mock:file
+---------+--------+------------+-----------+---------------------------------------------------------+
| SCOPE   | NAME   | FILESIZE   |   ADLER32 | RSE: REPLICA                                            |
|---------+--------+------------+-----------+---------------------------------------------------------|
| mock    | file   | 149.000 B  |    948240 | MOCK: file://localhost:0/tmp/rucio_rse/mock/fb/d1/file  |
|---------+--------+------------+-----------+---------------------------------------------------------|
| mock    | file   | 149.000 B  |    948240 | MOCK2: file://localhost:1/tmp/rucio_rse/mock/fb/d1/file |
+---------+--------+------------+-----------+---------------------------------------------------------+
</pre></div>
</div>
</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Rucio</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts and terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replica_workflow.html">Typical replica workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasepolicy.html">Release policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes.html">Release notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rest.html">RESTful APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">The Client API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database.html">Database operations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing_clients.html">Installing Rucio Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_examples.html">Rucio CLI: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="rucio.html">Rucio CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="rucio-admin.html">Rucio Administrative CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rse_expressions.html">RSE Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clients.html">Rucio Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clients.html#errors-and-exceptions">Errors and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage.html">Advanced Usage</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing_server.html">Installing Rucio server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing_daemons.html">Installing Rucio daemons</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="daemons.html">Daemons CLIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy_packages.html">Policy packages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli_examples.html">Rucio CLI: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_admin_examples.html">Rucio administration CLI: Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="daemons.html">Daemons CLIs</a><ul>
      <li>Previous: <a href="rucio-minos-temporary-expiration.html" title="previous chapter">Daemon rucio-minos-temporary-expiration</a></li>
      <li>Next: <a href="rucio-reaper.html" title="next chapter">Daemon rucio-reaper</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2012-2018 CERN for the benefit of the ATLAS collaboration.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/man/rucio-necromancer.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>