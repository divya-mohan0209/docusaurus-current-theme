

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DID Metadata &mdash; Rucio 1.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Rucio
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts and terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="replica_workflow.html">Typical replica workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasepolicy.html">Release policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Setting up a Rucio development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">RESTful APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The Client API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database operations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installing_clients.html">Installing Rucio Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_examples.html">Rucio CLI: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="man/rucio.html">Rucio CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="man/rucio-admin.html">Rucio Administrative CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="rse_expressions.html">RSE Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="clients.html">Rucio Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="clients.html#errors-and-exceptions">Errors and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html">Advanced Usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installing_server.html">Installing Rucio server</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_daemons.html">Installing Rucio daemons</a></li>
<li class="toctree-l1"><a class="reference internal" href="man/daemons.html">Daemons CLIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy_packages.html">Policy packages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo_environment.html">Setting up a Rucio development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_examples.html">Rucio CLI: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_admin_examples.html">Rucio administration CLI: Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Individual contributors to the source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html#organisations-employing-contributors">Organisations employing contributors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rucio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>DID Metadata</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/did_meta.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="did-metadata">
<h1>DID Metadata<a class="headerlink" href="#did-metadata" title="Permalink to this headline">¶</a></h1>
<p>Rucio supports adding Metadata on the dids.</p>
<dl>
<dt>Example::</dt><dd><p># Create a dataset to use on the Example
$ rucio add-dataset mock:testing_metadata</p>
<p># Add ‘optimized’ metadata that exist as columns in the did table
$ rucio set-metadata –did mock:testing_metadata –key panda_id –value 9999</p>
<p># Add ‘generic’ metadata. If there is no custom metadata plugin, the plugin ‘JSON’ will be used
$ rucio set-metadata –did mock:testing_metadata –key random_key_name –value 8888</p>
<p># Get the ‘optimized’ metadata
$ rucio get-metadata mock:testing_metadata</p>
<p># Get the Generic metadata
$ rucio get-metadata mock:testing_metadata –plugin JSON</p>
<p># Get all the metadata
$ rucio get-metadata mock:testing_metadata –plugin ALL</p>
<p># List dids according to metadata
$ rucio list-dids-extended mock:* –filter “type=ALL,panda_id=9999”
$ rucio list-dids-extended mock:* –filter “type=ALL,random_key_name=8888”</p>
</dd>
</dl>
<p>Even though regular users use metadata out of the box using the CLI, advanced users and Rucio admins should be aware that in the backend there are multiple options on how to store and manage the did metadata per experiment needs.</p>
<p>The concepts of DID Metadata Plugins exists on Rucio. While deploying the Rucio server you can configure which existing did plugins to use or even develop your own.</p>
<p>The default plugin in use the one originally developed for the needs of ATLAS, stores the metadata on fixed columns on the DID table and is the most optimal for the specific metadata.</p>
<p>Another option available is the JSON metadata plugin which stores the metadata in JSON blobs in the relational databased used by the Rucio Server.</p>
<p>When you are trying to add or fetch a VALUE for a given KEY, Rucio which asks in order each configured metadata plugin if it supports this KEY.</p>
<div class="section" id="how-to-develop-a-custom-metadata-solution">
<h2>How to develop a custom metadata solution<a class="headerlink" href="#how-to-develop-a-custom-metadata-solution" title="Permalink to this headline">¶</a></h2>
<p>The module you develop needs to extend the [DidMetaPlugin](/) Abstract class. The methods needed are</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_metadata</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Returns metadata stored in Plugin for given scope:name</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">set_metadata</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Sets the metadata in Plugin for given scope:name</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">delete_metadata</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Removes the metadata from the Plugin for given scope:name</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">list_dids</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;collection&#39;</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Returns a list of dids for given filters.</span>
<span class="sd">For long = True return should be a list of dictionaries having the keys &#39;scope&#39;, &#39;name&#39;, &#39;did_type&#39;, &#39;bytes&#39;, &#39;length&#39;.</span>
<span class="sd">For long = False return should be a list of strings containing the did names.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">manages_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Returns if Plugin is willing to manage metadata with given KEY.</span>
<span class="sd">Some Plugins might decide to accept only specific hardcoded keys, others might match against a particular regex while other might accept all possible keys.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-configure-which-metadata-plugin-to-use">
<h2>How to configure which metadata plugin to use<a class="headerlink" href="#how-to-configure-which-metadata-plugin-to-use" title="Permalink to this headline">¶</a></h2>
<p>Configuration options for Metadata are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
<span class="c1"># plugins = [list_of_plugins,comma_separated]</span>
<span class="n">plugins</span> <span class="o">=</span> <span class="p">[</span><span class="n">rucio</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">did_meta_plugins</span><span class="o">.</span><span class="n">did_column_meta</span><span class="o">.</span><span class="n">DidColumnMeta</span><span class="p">,</span> <span class="n">escape</span><span class="o">.</span><span class="n">rucio</span><span class="o">.</span><span class="n">did_meta_plugin</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2012-2018 CERN for the benefit of the ATLAS collaboration

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>